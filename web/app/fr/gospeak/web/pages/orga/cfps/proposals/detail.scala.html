@import com.mohiva.play.silhouette.api.actions.SecuredRequest
@import fr.gospeak.core.domain.{Cfp, Event, Group, Proposal, User}
@import fr.gospeak.libs.scalautils.domain.Url
@import fr.gospeak.web.auth.domain.CookieEnv
@import fr.gospeak.web.domain.Breadcrumb
@import fr.gospeak.web.pages.orga.cfps.proposals.routes.ProposalCtrl
@import fr.gospeak.web.pages.orga.events.routes.EventCtrl
@import fr.gospeak.web.pages.orga.partials.html.container
@import fr.gospeak.web.pages.orga.speakers.routes.SpeakerCtrl
@import fr.gospeak.web.pages.partials.display.html._
@import fr.gospeak.web.pages.partials.form.html._
@import fr.gospeak.web.pages.partials.html.{slidesFields, videoFields}

@(group: Group, cfp: Cfp, proposal: Proposal, speakers: Seq[User], events: Seq[Event], embedForm: Form[Url])(b: Breadcrumb)(implicit req: SecuredRequest[CookieEnv, AnyContent], messages: Messages)
@container(proposal.title.value + " - Gospeak", group, b)() {
    <h1 class="d-flex justify-content-between align-items-center">
        <span>@proposalStatusIcon(proposal.status) @proposal.title.value</span>
        <span class="btn-group">
            <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-cog"></i>
            </button>
            <span class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" href="@ProposalCtrl.edit(group.slug, cfp.slug, proposal.id)">Edit</a>
                @if(proposal.status != Proposal.Status.Declined) {
                    @formBtn(ProposalCtrl.reject(group.slug, cfp.slug, proposal.id), Seq(
                        "class" -> "dropdown-item",
                        "title" -> Proposal.Status.Declined.description,
                        "data-toggle" -> "tooltip",
                        "data-placement" -> "left")) {Reject this proposal}
                } else {
                    @formBtn(ProposalCtrl.cancelRejection(group.slug, cfp.slug, proposal.id), Seq("class" -> "dropdown-item")) {Cancel proposal rejection}
                }
            </span>
        </span>
    </h1>

    @proposal.event.map { id => <h2>Added to @event(events, id, Some(e => EventCtrl.detail(group.slug, e.slug)))</h2> }
    <p>@duration(proposal.duration) @slidesIcon(proposal.slides) @videoIcon(proposal.video) @tags(proposal.tags)</p>
    <p>Speakers: @proposal.speakers.toList.map { id => @speaker(speakers, id, Some(u => SpeakerCtrl.detail(group.slug, u.slug))) }</p>
    <p>@markdown(proposal.description)</p>

    @if(proposal.slides.isEmpty) { @slidesFields(embedForm, ProposalCtrl.doAddSlides(group.slug, cfp.slug, proposal.id)) }
    @if(proposal.video.isEmpty) { @videoFields(embedForm, ProposalCtrl.doAddVideo(group.slug, cfp.slug, proposal.id)) }

    <p>@info(proposal.info, speakers, Some(u => SpeakerCtrl.detail(group.slug, u.slug)))</p>
}()
