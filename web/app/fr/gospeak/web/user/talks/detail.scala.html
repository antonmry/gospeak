@import fr.gospeak.core.domain.utils.Page
@import fr.gospeak.core.domain.{Cfp, Proposal, Talk, User}
@import fr.gospeak.web.user.talks.partials
@import fr.gospeak.web.domain.{Breadcrumb, HeaderInfo}
@import fr.gospeak.web.partials.html.container
@import fr.gospeak.web.partials.display.html.timeAgo
@import fr.gospeak.web.user.talks.proposals.routes.ProposalCtrl
@import fr.gospeak.web.user.talks.cfps.routes.CfpCtrl

@(talk: Talk, speakers: Seq[User], proposals: Page[(Cfp, Proposal)])(h: HeaderInfo, b: Breadcrumb)(implicit user: User, flash: Flash)
@container("Gospeak", h, Some(b))() {
    @if(talk.status == Talk.Status.Created) {
        <div class="alert alert-info" role="alert">
            <p class="mb-0 float-right">
                <a class="btn btn-sm btn-secondary"
                href="TODO"
                title="Only you can see it, you can propose it to groups but organizers will not see it"
                data-toggle="tooltip" data-placement="bottom">Make it private</a>
                <a class="btn btn-sm btn-primary"
                href="TODO"
                title="Group organizers will be able to search for it and send you speaking proposals"
                data-toggle="tooltip" data-placement="bottom">Make it public</a>
            </p>
            <h4 class="alert-heading">Well done!</h4>
            <p class="mb-0">You created a talk, now decide if you want it to be <b>Public</b> or <b>Private</b></p>
        </div>
    }
    <div>
        <div class="float-right">
            <div class="btn-group">
                <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="TODO">Edit</a>
                    @if(talk.status != Talk.Status.Public) {
                        <a class="dropdown-item"
                        href="TODO"
                        title="Only you can see it, you can propose it to groups but organizers will not see it"
                        data-toggle="tooltip" data-placement="left">Make it public</a>
                    }
                    @if(talk.status != Talk.Status.Private) {
                        <a class="dropdown-item"
                        href="TODO"
                        title="Group organizers will be able to search for it and send you speaking proposals"
                        data-toggle="tooltip" data-placement="left">Make it private</a>
                    }
                    @if(talk.status != Talk.Status.Archived) {
                        <a class="dropdown-item"
                        href="TODO"
                        title="When your talk is not actual anymore. It will be hided by default everywhere"
                        data-toggle="tooltip" data-placement="left">Archive it</a>
                    }
                </div>
            </div>
        </div>
        <h1>@talk.title.value</h1>
        @partials.html.status(talk.status) @partials.html.duration(talk.duration)
    </div>

    <p>@talk.description</p>

    <p>Speakers: @talk.speakers.toList.map { id => @partials.html.speaker(speakers, id) }</p>

    @if(proposals.isEmpty) {
        <div class="card">
            <h5 class="card-header">Your talk was not proposed to any CFP</h5>
            <div class="card-body text-center">
                <h5 class="card-title">Well done! You have a new talk</h5>
                <p class="card-text">
                    Now found some groups to speak or make it public to receive some speaking requests
                </p>
                <a href="@CfpCtrl.list(talk.slug)" class="btn btn-success">Find a CFP to propose your talk</a>
            </div>
        </div>
    } else {
        <div class="card">
            <h5 class="card-header">
                <span class="float-right">
                    <a class="btn btn-primary btn-sm" href="@CfpCtrl.list(talk.slug)">Find a CFP to propose your talk</a>
                </span>
                You proposed your talk to @proposals.total.value CFPs:
            </h5>
            <ul class="list-group list-group-flush">
            @proposals.items.map { case (cfp, proposal) =>
            <a href="@ProposalCtrl.detail(talk.slug, proposal.id)" class="list-group-item list-group-item-action d-flex w-100 justify-content-between">
                <div>
                    <h5 class="mb-1">@cfp.name.value</h5>
                    <p class="mb-1">Title: @proposal.title.value</p>
                </div>
                <div class="text-right">
                    <small>@timeAgo(proposal.info.created)</small><br>
                    <span class="badge badge-primary">TODO: proposal status</span>
                </div>
            </a>
            }
            </ul>
            @if(!proposals.isLast) {
                <a href="@ProposalCtrl.list(talk.slug)" class="list-group-item list-group-item-action">More...</a>
            }
        </div>
    }
}()
