@import fr.gospeak.core.domain.{Cfp, Event, Proposal, Talk, User}
@import fr.gospeak.libs.scalautils.domain.Url
@import fr.gospeak.web.domain.{Breadcrumb, HeaderInfo}
@import fr.gospeak.web.partials.display.html._
@import fr.gospeak.web.partials.form.html._
@import fr.gospeak.web.partials.html.container
@import fr.gospeak.web.user.talks.proposals.routes.ProposalCtrl
@import fr.gospeak.web.utils.Formats

@(talk: Talk, cfp: Cfp, proposal: Proposal, speakers: Seq[User], events: Seq[Event], embedForm: Form[Url])(h: HeaderInfo, b: Breadcrumb)(implicit user: User, req: Request[AnyContent], messages: Messages, flash: Flash)
@eventinfo(id: Event.Id) = {
    @events.find(_.id == id).map { e => @e.name.value - @Formats.date(e.start) }.getOrElse { Unknown event @id.value }
}
@container(cfp.name.value + " - Gospeak", h, Some(b))() {
    <div>
        <h1>@proposal.title.value proposal to @cfp.name.value</h1>
        @duration(proposal.duration) @proposalStatus(proposal.status) @proposal.event.map { id => @eventinfo(id) }
    </div>

    <p>@markdown(proposal.description)</p>

    <p>Speakers: @proposal.speakers.toList.map { id => @speaker(speakers, id) }</p>

    @proposal.slides.map { s => @embed(s.value) }.getOrElse {
        @formElt(embedForm, ProposalCtrl.doAddSlides(talk.slug, proposal.id), Seq("class" -> "mb-2")) {
            @fieldHorizontal(embedForm("url"), Seq("label" -> "Slides")) { (field, _) =>
                @inputEmbed(field, Seq("placeholder" -> "Url of the slides"))
            }
            @actionsHorizontal() {
                @btnSubmit("Add slides", "btn btn-secondary")
            }
        }
    }
    @proposal.video.map { v => @embed(v.value) }.getOrElse {
        @formElt(embedForm, ProposalCtrl.doAddVideo(talk.slug, proposal.id), Seq("class" -> "mb-2")) {
            @fieldHorizontal(embedForm("url"), Seq("label" -> "Video")) { (field, _) =>
                @inputEmbed(field, Seq("placeholder" -> "Url of the video"))
            }
            @actionsHorizontal() {
                @btnSubmit("Add video", "btn btn-secondary")
            }
        }
    }

    <p>@info(proposal.info, speakers)</p>
}()
