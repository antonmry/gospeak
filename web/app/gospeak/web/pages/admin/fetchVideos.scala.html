@import gospeak.core.domain.ExternalEvent
@import gospeak.libs.scala.domain.Page
@import gospeak.web.pages.admin.partials.html.container
@import gospeak.web.pages.admin.routes.AdminCtrl
@import gospeak.web.pages.partials.form.html.formBtn
@import gospeak.web.pages.published.events.routes.EventCtrl
@import gospeak.web.utils.{AdminReq, Formats}

@(extEvents: Page[(ExternalEvent, Long)])(implicit req: AdminReq[AnyContent])
@videoListTemplate(event: ExternalEvent, videoCount: Long) = {
    <tr @if(event.videos.isEmpty){class="table-danger"} else {@if(videoCount == 0){class="table-primary"}}>
        <td>@event.name.value <a href="@EventCtrl.detailExt(event.id)" target="_blank"><i class="fas fa-external-link-alt"></i></a></td>
        <td>@videoCount videos</td>
        <td>@event.videos.map { u => <a href="@u.value" target="_blank">@u.platform @u.kind</a> }.getOrElse{No video link}</td>
        <td>@formBtn(AdminCtrl.updateExtEventVideos(event.id), Seq("class" -> "btn-success btn-xs")){Update videos}</td>
    </tr>
}
@container(s"Admin")() {
    <h1>Videos</h1>
    <p>A list of video links available</p>
    @Formats.paginatedCustom[(ExternalEvent, Long)](extEvents, AdminCtrl.fetchVideos) { p =>
        <table class="table table-sm table-hover">
            <thead>
                <tr>
                    <th scope="col">Event</th>
                    <th scope="col">Videos</th>
                    <th scope="col">Link</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
    } { <tr><td colspan="4" class="text-center p-5">No results <i class="far fa-sad-tear"></i></td></tr> } { case (e, v) =>
        @videoListTemplate(e, v)
    } { p =>
            </tbody>
        </table>
    }
}()
