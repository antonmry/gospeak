@import gospeak.core.domain.Event
@import gospeak.core.services.meetup.domain.MeetupAttendee
@import gospeak.web.domain.PageMeta
@import gospeak.web.pages.partials.container.html.main
@import gospeak.web.pages.published.groups.routes.GroupCtrl
@import gospeak.web.utils.UserAwareReq

@(event: Event.Full, attendeesEither: Either[String, Seq[MeetupAttendee]])(implicit req: UserAwareReq[AnyContent])
@main(s"Attendee draw for ${event.name.value} - Gospeak", PageMeta.default(GroupCtrl.eventDrawMeetupAttendee(event.group.slug, event.slug)), style = Html(
    """<style>
      |html, body, .container {
      |  height: 100%;
      |}
      |.attendee-card {
      |  display: none;
      |}
      |</style>
      |""".stripMargin), script = Html(
    """<script>
      |  const attendees = $('.attendee-card');
      |  $('.attendee-draw').click(function (e) {
      |     $('.attendee-draw-first').hide();
      |     attendees.hide();
      |     const i = Math.floor(Math.random() * attendees.length);
      |     $(attendees[i]).show();
      |  });
      |</script>
      |""".stripMargin)) {
    <div class="container d-flex justify-content-center align-items-center">
        @attendeesEither match {
            case Right(attendees) => {
                <button type="button" class="btn btn-primary btn-lg attendee-draw attendee-draw-first">Draw attendee</button>
                @attendees.map { a =>
                    <div class="card attendee-card mb-3" style="max-width: 540px;">
                        <div class="row no-gutters">
                            <div class="col-md-4 d-flex align-items-center">
                                <img src="@a.avatar.map(_.value).getOrElse(s"https://api.adorable.io/avatars/200/${a.id.value}.png")" class="card-img" alt="@a.name avatar">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title">@a.name</h5>
                                    @a.bio.map { bio => <p class="card-text">@bio</p> }
                                    <button type="button" class="btn btn-outline-secondary attendee-draw">Draw again</button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            case Left(err) => {<div class="alert alert-danger" role="alert">@err</div>}
        }
    </div>
}
